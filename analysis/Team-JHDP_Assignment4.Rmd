---
title: "Expert advice from experts"
author:
- familyname: Troy
  othernames: Helen
  title: Professor
  qualifications: BSc, PhD
  email: helen.troy@gmail.com
  correspondingauthor: true
- familyname: Khan
  othernames: Genghis
  title: Mr
  qualifications: BA, BComm, BCompSci, BLaw
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE, 
                      warning=FALSE)
```

```{r}
library(ggplot2)
library(tidyverse)
library(haven)
library(lubridate)
library(broom)
library(tidyr)
library(base)
library(glue)
library(naniar) # For missing values
```


# Introduction 

Job types, job locations, rising demand for certain job categories, these are just some of the aspects of job hunting that many working people around the world are intrigued by. In this report, you will find an in depth analysis into the distribution of job listings across Australia. The report will analyze 3 main sections of job distribution within Australia, broken down by:

1) The change in demand by job category
2) The change in demand for jobs by city
3) The change in demand by job type

Our motivation to choose this as our research topic is prompted by experiencing first hand the cataclysmic effects of the coronavirus and the impact it has had on the job market globally. It has been an unfortunate scenario to witness unemployment rates skyrocket in major cities around the world. Thus, we want to visualize the changes in demand to jobs of all types and categories in Australia, particularly in the major cities.

# Dataset and Methodology
- Source of data. (Dewi)  
- Limitations (Hanh - master)  
- Methodology: How we deal with this dataset. ( Peimin - master)  

# Analysis:
### Clean the data: 
1. isolate the month + year (Hanh - master branch)  
```{r load-data, cache = TRUE}
raw_data <- read.csv(here::here("data", "seek_australia_sample.csv"))
```

```{r clean-data, cache = TRUE}
#choose the needed columns only 
data_cleaned <- raw_data %>%
  select(3:9,11)

# separate the post-date column to get the date out
data_cleaned <- data_cleaned %>%
  separate (post_date, into = c("post_date", "tz"), sep = "T")

# convert the post_date column from character to date format
data_cleaned %>%
  mutate_at(vars(post_date), as.Date, format = "%Y-%m-%d")
```

```{r read-states, cache = TRUE}
# Import the list of cities and states in Australia for joining
# List is not exhaustive
states <- read.csv(here::here("data","au.csv"))
```

```{r state-clean, cache = TRUE}
# Clean and update state names
by_city <- data_cleaned %>%
  filter(geo == "AU") %>%
  separate_rows(city, sep = " & ") %>%
  separate_rows(city, sep = ", ") %>%
  separate_rows(city, sep = " and ")

# Specify state name for each city
by_city <- by_city %>%
  left_join(states, by = "city") %>%
  rename("state" = admin)

# check the missing
vis_miss(by_city)
```

```{r clean-city-name, cache = TRUE}
# Manually adjust missing state
by_city_cleaned <- by_city %>%
  mutate(
    state = case_when(
    str_detect(city, "TAS") ~ "Tasmania",
    str_detect(city, "VIC") ~ "Victoria",
    str_detect(city, "NSW") ~ "New South Wales",
    str_detect(city, "ACT") ~ "Australian Capital Territory",
    str_detect(city, "QLD") ~ "Queensland",
    str_detect(city, "SA") ~ "South Australia",
    str_detect(city, "Wide Bay Burnett") ~ "Queensland",
    str_detect(city, "Sunshine Coast") ~ "Queensland",
    str_detect(city, "Great Ocean Road") ~ "Victoria",
    str_detect(city, "Mackay") ~ "Queensland",
    str_detect(city, "Coalfields") ~ "New South Wales",
    str_detect(city, "Murray") ~ "Victoria",
    str_detect(city, "Maitland") ~ "New South Wales",
    str_detect(city, "Hunter") ~ "New South Wales",
    str_detect(city, "Gosford") ~ "New South Wales",
    str_detect(city, "Pilbara") ~ "Western Australia",
    str_detect(city, "Central Highlands") ~ "Queensland",
    str_detect(city, "Blue Mountains") ~ "New South Wales",
    str_detect(city, "Northern Australia") ~ "Northern Territory",
    str_detect(city, "Illawarra") ~ "New South Wales",
    str_detect(city, "South Coast") ~ "New South Wales",
    str_detect(city, "Southern Tablelands") ~ "New South Wales",
    str_detect(city, "Far North") ~ "Queensland",
    str_detect(city, "Hawkesbury") ~ "New South Wales",
    str_detect(city, "Darling Downs") ~ "Queensland",
    str_detect(city, "Kimberley") ~ "Western Australia",
    str_detect(city, "Peel") ~ "Western Australia",
    str_detect(city, "La Trobe Valley") ~ "Victoria",
    str_detect(city, "Somerset") ~ "Queensland",
    str_detect(city, "Lockyer") ~ "Western Australia",
    str_detect(city, "Goldfields") ~ "Western Australia",
    str_detect(city, "Macedon Ranges") ~ "Victoria",
    str_detect(city, "Mt Gambier") ~ "South Australia",
    str_detect(city, "Limestone Coast") ~ "South Australia",
    str_detect(city, "Wheatbelt") ~ "Western Australia",
    str_detect(city, "Riverina") ~ "New South Wales",
    str_detect(city, "Capricorn Coast") ~ "Queensland",
    str_detect(city, "Gascoyne") ~ "Western Australia",
    str_detect(city, "Mornington Peninsula") ~ "Victoria",
    str_detect(city, "Bass Coast") ~ "Victoria",
    str_detect(city, "Lismore") ~ "New South Wales",
    str_detect(city, "Far North Coast") ~ "New South Wales",
    str_detect(city, "Goulburn Valley") ~ "Victoria",
    str_detect(city, "Yarra Valley") ~ "Victoria",
    str_detect(city, "High Country") ~ "Victoria",
    str_detect(city, "Eyre Peninsula") ~ "South Australia",
    str_detect(city, "Bairnsdale") ~ "Victoria",
    str_detect(city, "Gippsland") ~ "Victoria",
    str_detect(city, "Mt Isa") ~ "Queensland",
    str_detect(city, "North Coast") ~ "New South Wales",
    str_detect(city, "Albury Wodonga") ~ "New South Wales",
    str_detect(city, "Yorke Peninsula") ~ "South Australia",
    str_detect(city, "Clare Valley") ~ "South Australia",
    str_detect(city, "Fraser Coast") ~ "Queensland",
    str_detect(city, "Great Southern") ~ "Western Australia",
    str_detect(city, "Tamworth") ~ "New South Wales",
    str_detect(city, "Southern Highlands") ~ "New South Wales",
    str_detect(city, "Tablelands") ~ "Queensland",
    str_detect(city, "Snowy") ~ "New South Wales",
    str_detect(city, "Monaro") ~ "New South Wales",
    str_detect(city, "West Gippsland") ~ "Victoria",
    str_detect(city, "Latrobe Valley") ~ "Victoria",
    str_detect(city, "Adelaide Hills") ~ "South Australia",
    str_detect(city, "Barossa") ~ "South Australia",
    str_detect(city, "Albury Area") ~ "New South Wales",
    str_detect(city, "Grampians") ~ "Victoria",
    str_detect(city, "Riverland") ~ "South Australia",
    str_detect(city, "Murray Mallee") ~ "Victoria",
    str_detect(city, "Fleurieu Peninsula") ~ "South Australia",
    str_detect(city, "Kangaroo Island") ~ "South Australia",
    str_detect(city, "Coober Pedy") ~ "South Australia",
    str_detect(city, "Central West") ~ "New South Wales",
    str_detect(city, "South West") ~ "South Australia",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "North West") ~ "Tasmania",
    str_detect(city, "Central Australia") ~ "Northern Territory",
    str_detect(city, "Midwest") ~ "Western Australia",
    str_detect(city, "Far West") ~ "New South Wales",
    str_detect(city, "South East") ~ "Tasmania",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "Central") ~ "Tasmania",
    TRUE ~ as.character(state))
  ) %>%
  filter(!city == "")
```

_Reources:_ 
https://simplemaps.com/data/au-cities
https://stackoverflow.com/questions/15347282/split-delimited-strings-in-a-column-and-insert-as-new-rows
https://github.com/Elkfox/Australian-Postcode-Data
https://download.geonames.org/export/zip/

2. Missing values  (Hanh - Hanh-Ngo branch)  
```{r}
# Using the raw data to show missing values
miss_data <- by_city_cleaned %>%
  # Replace blank values with NA
  mutate_all(na_if,"")
vis_miss(miss_data)
gg_miss_upset(miss_data)
```


### Analyze the change in demand by job category) (Peimin-Peimin branch)


### Analyze the change in demand by city + life quality  
1. Change in demand (Hanh)    

```{r}
# Convert Date column from character to Date format for geom_line
by_city_cleaned <- by_city_cleaned %>%
  mutate_at(vars(post_date), as.Date, format = "%Y-%m-%d")

by_city_cleaned %>%
  group_by(post_date, state) %>%
  summarise("count" = n()) %>%
  ungroup() %>%
  ggplot(aes(x = post_date,
             y = count)) +
  geom_line(color = "#00008B") +
  facet_wrap(~ state, scales = "fixed") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.3)) +
  theme_bw() +
  labs(title = "Count of jobs posted by days",
       x = "Date",
       y = "Number of jobs")
```

The number of jobs posted for main 

For easier look, facet wrap only the low demand states to see changes:
```{r}
by_city_cleaned %>%
  filter (!state %in% c("New South Wales",
                        "Queensland",
                        "Victoria",
                        "Western Australia")) %>%
  group_by(post_date, state) %>%
  summarise("count" = n()) %>%
  ungroup() %>%
  ggplot(aes(x = post_date,
             y = count)) +
  geom_line(color = "#FF0000") +
  facet_wrap(~ state, scales = "fixed") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.3)) +
  theme_bw() +
  labs(title = "Count of jobs posted by days",
       x = "Date",
       y = "Number of jobs")
```

A noticable trend is that job posts were of plenty on April accross all states. 

Change to test git push

2. How does it reflect life quality? (Dewi)

### Analyze the change in demand by job type (Justin’s branch)

# Conclusion: (Justin - master branch)




