---
title: "Distribution of job listings across Australia"
author:
- familyname: Troy
  othernames: Helen
  title: Professor
  qualifications: BSc, PhD
  email: helen.troy@gmail.com
  correspondingauthor: true
- familyname: Khan
  othernames: Genghis
  title: Mr
  qualifications: BA, BComm, BCompSci, BLaw
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE, 
                      warning=FALSE)
```

```{r}
library(ggplot2)
library(tidyverse)
library(haven)
library(lubridate)
library(broom)
library(tidyr)
library(base)
library(glue)
```


# Introduction 

Job types, job locations, rising demand for certain job categories, these are just some of the aspects of job hunting that many working people around the world are intrigued by. In this report, you will find an in depth analysis into the distribution of job listings across Australia. The report will analyze 3 main sections of job distribution within Australia, broken down by:

1) The change in demand by job category
2) The change in demand for jobs by city
3) The change in demand by job type

Our motivation to choose this as our research topic is prompted by experiencing first hand the cataclysmic effects of the coronavirus and the impact it has had on the job market globally. It has been an unfortunate scenario to witness unemployment rates skyrocket in major cities around the world. Thus, we want to visualize the changes in demand to jobs of all types and categories in Australia, particularly in the major cities.

# Dataset and Methodology

## Source of Data

To portray the change of job demand in Australia, we used an Australia job listing data that downloaded from [Kaggle](https://www.kaggle.com/PromptCloudHQ/australian-job-listings-data-from-seek-job-board) provided by [PromptCloud](https://www.promptcloud.com), a web-scraping company. Originally, this data was scraped from [Seek](https://www.seek.com.au) job board. This dataset has a [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) license, where people are free to share and adapt the data. It contains 20,030 observations and 13 variables, but only 8 variables that are going to use in te analysis. They are: job title; category of job; company name; city; date when jobs were posted; time when jobs were posted; job description; and job type. 


- Limitations (Hanh - master) 
- Methodology: How we deal with this dataset. ( Peimin - master)  

# Analysis:
### Clean the data: 
1. isolate the month + year (Hanh - master branch)  
```{r load-data, cache = TRUE}
raw_data <- read.csv(here::here("data", "seek_australia_sample.csv"))
```

```{r clean-data}
# choose the needed columns only
data_cleaned <- raw_data %>%
  select(3:9)

# separate the post-date column to get the date out
data_cleaned <- data_cleaned %>%
  separate (post_date, into = c("post_date", "tz"), sep = "T")

# convert the post_date column from character to date format
data_cleaned %>%
  mutate_at(vars(post_date), as.Date, format = "%Y-%m-%d")
```

```{r read-states}
states <- read.csv(here::here("data","au.csv"))
```

```{r state-clean}
# Clean and update state names
by_city <- data_cleaned %>%
  filter(geo == "AU") %>%
  separate_rows(city, sep = " & ") %>%
  separate_rows(city, sep = ", ") %>%
  separate_rows(city, sep = " and ")

# Specify names for each city
by_city <- by_city %>%
  left_join(states, by = "city") %>%
  rename("state" = admin)

# check the missing
vis_miss(by_city)
```

```{r clean-city-name}
# Manually adjust missing state
by_city_cleaned <- by_city %>%
  mutate(
    state = case_when(
    str_detect(city, "TAS") ~ "Tasmania",
    str_detect(city, "VIC") ~ "Victoria",
    str_detect(city, "NSW") ~ "New South Wales",
    str_detect(city, "ACT") ~ "Australian Capital Territory",
    str_detect(city, "QLD") ~ "Queensland",
    str_detect(city, "SA") ~ "South Australia",
    str_detect(city, "Wide Bay Burnett") ~ "Queensland",
    str_detect(city, "Sunshine Coast") ~ "Queensland",
    str_detect(city, "Great Ocean Road") ~ "Victoria",
    str_detect(city, "Mackay") ~ "Queensland",
    str_detect(city, "Coalfields") ~ "New South Wales",
    str_detect(city, "Murray") ~ "Victoria",
    str_detect(city, "Maitland") ~ "New South Wales",
    str_detect(city, "Hunter") ~ "New South Wales",
    str_detect(city, "Gosford") ~ "New South Wales",
    str_detect(city, "Pilbara") ~ "Western Australia",
    str_detect(city, "Central Highlands") ~ "Queensland",
    str_detect(city, "Blue Mountains") ~ "New South Wales",
    str_detect(city, "Northern Australia") ~ "Northern Territory",
    str_detect(city, "Illawarra") ~ "New South Wales",
    str_detect(city, "South Coast") ~ "New South Wales",
    str_detect(city, "Southern Tablelands") ~ "New South Wales",
    str_detect(city, "Far North") ~ "Queensland",
    str_detect(city, "Hawkesbury") ~ "New South Wales",
    str_detect(city, "Darling Downs") ~ "Queensland",
    str_detect(city, "Kimberley") ~ "Western Australia",
    str_detect(city, "Peel") ~ "Western Australia",
    str_detect(city, "La Trobe Valley") ~ "Victoria",
    str_detect(city, "Somerset") ~ "Queensland",
    str_detect(city, "Lockyer") ~ "Western Australia",
    str_detect(city, "Goldfields") ~ "Western Australia",
    str_detect(city, "Macedon Ranges") ~ "Victoria",
    str_detect(city, "Mt Gambier") ~ "South Australia",
    str_detect(city, "Limestone Coast") ~ "South Australia",
    str_detect(city, "Wheatbelt") ~ "Western Australia",
    str_detect(city, "Riverina") ~ "New South Wales",
    str_detect(city, "Capricorn Coast") ~ "Queensland",
    str_detect(city, "Gascoyne") ~ "Western Australia",
    str_detect(city, "Mornington Peninsula") ~ "Victoria",
    str_detect(city, "Bass Coast") ~ "Victoria",
    str_detect(city, "Lismore") ~ "New South Wales",
    str_detect(city, "Far North Coast") ~ "New South Wales",
    str_detect(city, "Goulburn Valley") ~ "Victoria",
    str_detect(city, "Yarra Valley") ~ "Victoria",
    str_detect(city, "High Country") ~ "Victoria",
    str_detect(city, "Eyre Peninsula") ~ "South Australia",
    str_detect(city, "Bairnsdale") ~ "Victoria",
    str_detect(city, "Gippsland") ~ "Victoria",
    str_detect(city, "Mt Isa") ~ "Queensland",
    str_detect(city, "North Coast") ~ "New South Wales",
    str_detect(city, "Albury Wodonga") ~ "New South Wales",
    str_detect(city, "Yorke Peninsula") ~ "South Australia",
    str_detect(city, "Clare Valley") ~ "South Australia",
    str_detect(city, "Fraser Coast") ~ "Queensland",
    str_detect(city, "Great Southern") ~ "Western Australia",
    str_detect(city, "Tamworth") ~ "New South Wales",
    str_detect(city, "Southern Highlands") ~ "New South Wales",
    str_detect(city, "Tablelands") ~ "Queensland",
    str_detect(city, "Snowy") ~ "New South Wales",
    str_detect(city, "Monaro") ~ "New South Wales",
    str_detect(city, "West Gippsland") ~ "Victoria",
    str_detect(city, "Latrobe Valley") ~ "Victoria",
    str_detect(city, "Adelaide Hills") ~ "South Australia",
    str_detect(city, "Barossa") ~ "South Australia",
    str_detect(city, "Albury Area") ~ "New South Wales",
    str_detect(city, "Grampians") ~ "Victoria",
    str_detect(city, "Riverland") ~ "South Australia",
    str_detect(city, "Murray Mallee") ~ "Victoria",
    str_detect(city, "Fleurieu Peninsula") ~ "South Australia",
    str_detect(city, "Kangaroo Island") ~ "South Australia",
    str_detect(city, "Coober Pedy") ~ "South Australia",
    str_detect(city, "Central West") ~ "New South Wales",
    str_detect(city, "South West") ~ "South Australia",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "North West") ~ "Tasmania",
    str_detect(city, "Central Australia") ~ "Northern Territory",
    str_detect(city, "Midwest") ~ "Western Australia",
    str_detect(city, "Far West") ~ "New South Wales",
    str_detect(city, "South East") ~ "Tasmania",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "Central") ~ "Tasmania",
    TRUE ~ as.character(state))
  ) %>%
  filter(!city == "")
```

2. Missing values  (Hanh - Hanh-Ngo branch)  

### Analyze the change in demand by job category) (Peimin-Peimin branch)


### Analyze the change in demand by city + life quality  
1. Change in demand (Hanh)    

### Job availibility and living cost


According to @davidlasswell, when searching for a job, cost of living should be taken into account. It also relates to the question whether the salary of the job would be enough to cover the living cost in a particular city. Therefore, in this subsection, the living cost in some cities in Australia with relatively have more job listings would be observed.


```{r livingcost, message = FALSE, include = FALSE}

# Scraping living cost data

library(polite)
library(rvest)
library(xml2)
library(readr)

# ensure that the website is scrapable 

bow("https://www.numbeo.com/cost-of-living/rankings.jsp?title=2018")

cost <- bow("https://www.numbeo.com/cost-of-living/rankings.jsp?title=2018")

cost_scraped <- scrape(cost)

# scrape the city column

city <- cost_scraped %>%
  html_nodes(".cityOrCountryInIndicesTable") %>%
  html_text()

# make a function to scrape based on html nodes

get_data <- function(column){
  cost_scraped %>% 
    html_nodes(paste0("td:nth-child(",column,")")) %>% 
    html_text() %>% 
    parse_number
} 

# scrape the living cost index

rent <- get_data("4")
cost_living_rent <- get_data("5")
grocery <- get_data("6")
restaurant <- get_data("7")
local_purchase_power <- get_data("8")

# create the table of living cost

cost_of_living <- tibble(city = city,
                         rent = rent,
                         grocery = grocery,
                         restaurant = restaurant,
                         local_purchasing_power_index = local_purchase_power,
                         living_cost_incld_rent = cost_living_rent)

# filter only the country in Australia
cost_of_living_au <- cost_of_living %>%
  filter(str_detect(city,"Australia")) %>%
  separate(city, into = c("city", "country"), sep = ",")

# add state column to the data
cost_of_living_state <- cost_of_living_au %>% mutate(
  state = case_when(
    str_detect(city, "Sydney") ~ "NSW",
    str_detect(city, "Newcastle") ~ "NSW",
    str_detect(city, "Brisbane") ~ "QLD",
    str_detect(city, "Gold Coast") ~ "QLD",
    str_detect(city, "Canberra") ~ "ACT",
    str_detect(city, "Perth") ~ "WA",
    str_detect(city, "Melbourne") ~ "VIC",
    str_detect(city, "Adelaide") ~ "SA",
    str_detect(city, "Hobart") ~ "TAS",
    str_detect(city, "Darwin") ~ "NT",
    str_detect(city, "Cairns") ~ "QLD")
)
```

```{r livingcostplot, fig.cap = "Living cost of 2018 by city"}

library(forcats)

ggplot(cost_of_living_state) +
  geom_point(aes(x = living_cost_incld_rent,
                 y = reorder(city, living_cost_incld_rent)),
             color = "#FF0080") +
  xlab("Cost of living plus rent index") +
  ylab("City")

```




Figure \ref{fig:livingcostplot} shows that Sydney was found to be the city with the highest living cost. Whilst generally, the living cost index in most cities in Australia, ranged betwen 60 to 68. The figure also conveys that Gold Coast was the city with the lowest living cost in Australia. 

It is also interesting to observe whether there is a correlation between the living cost in those cities and the number of job listings in there. However, the number of job listings in those cities would be examined first.

```{r jobcity}

job_city_table <- data_cleaned %>%
  group_by(city) %>%
  count() %>%
  arrange(desc(n)) #%>%
  #filter(city %in% c("Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Hobart", "Darwin", "ACT"))

#library(kableExtra)
#kable(job_city_table,
      #caption = "The number of job availability in Australian states capital cities in 2018",
      #"latex",
      #col.names = c("City", "Number of Jobs Listings"),
      #booktabs = TRUE) %>%
  #kable_styling("striped")
```

Table \ref{tab:jobcity} conveys that Sydney, Melbourne, Brisbane, and Perth was being the cities with most job listings. These cities had more than 1000 jobs available in April to December 2018. 




### Analyze the change in demand by job type (Justinâ€™s branch)

# Conclusion: (Justin - master branch)




