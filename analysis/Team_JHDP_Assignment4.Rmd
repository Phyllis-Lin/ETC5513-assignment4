---
title: "Expert advice from experts"
author:
- familyname: Troy
  othernames: Helen
  title: Professor
  qualifications: BSc, PhD
  email: helen.troy@gmail.com
  correspondingauthor: true
- familyname: Khan
  othernames: Genghis
  title: Mr
  qualifications: BA, BComm, BCompSci, BLaw
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE, 
                      warning=FALSE)
```

```{r}
library(ggplot2)
library(tidyverse)
library(haven)
library(lubridate)
library(broom)
library(tidyr)
library(base)
library(glue)
library(naniar) # For missing values
```


# Introduction 

Job types, job locations, rising demand for certain job categories, these are just some of the aspects of job hunting that many working people around the world are intrigued by. In this report, you will find an in depth analysis into the distribution of job listings across Australia. The report will analyze 3 main sections of job distribution within Australia, broken down by:

1) The change in demand by job category
2) The change in demand for jobs by city
3) The change in demand by job type

Our motivation to choose this as our research topic is prompted by experiencing first hand the cataclysmic effects of the coronavirus and the impact it has had on the job market globally. It has been an unfortunate scenario to witness unemployment rates skyrocket in major cities around the world. Thus, we want to visualize the changes in demand to jobs of all types and categories in Australia, particularly in the major cities.

# Data set and Methodology
### Source of data. (Dewi)  
To portray the change of job demand in Australia, we used an Australia job listing data that downloaded from [Kaggle](https://www.kaggle.com/PromptCloudHQ/australian-job-listings-data-from-seek-job-board) provided by [PromptCloud](https://www.promptcloud.com), a web-scraping company. Originally, this data was scraped from [Seek](https://www.seek.com.au) job board. This data set has a [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) license, where people are free to share and adapt the data. It contains 20,030 observations and 13 variables, but only 8 variables that are going to use in the analysis. They are: job title; category of job; company name; city; date when jobs were posted; time when jobs were posted; job description; and job type. 

### Limitations (Hanh - master)  
- Data collection method: Even though the origin of data set was provided (obtained from Kaggle, collected by PromptCloud and scraped from Seek), it is hard to verify the credibility of the data set, whether the data was obtained in full and in completeness (with no observations being collected incorrectly). Instead the data was use as it at the time of obtaining from Kaggle.  
- Sample size: The collection period ran from 20 April 2018 to 26 October 2018 which accounted for 6 months of 2018. A sample set contained observations for less than one year period may hinder the ability to reflect seasonal cycle or pattern of the studied objects, which in turns may limit the explanatory power of the data set.  
- Scope of discussion: The data set was tidied, visualised and interpreted under personal opinions of a group of individuals from which view, to some, may be bias and incompleteness based on the personal experience and knowledge of the authors.  

### Methodology: How we deal with this data set. ( Peimin - master)  

# Analysis:
### Inspecting the Data set
#### Clean the data: 
1. isolate the month + year (Hanh - master branch)  
```{r load-data, cache = TRUE}
raw_data <- read.csv(here::here("data", "seek_australia_sample.csv"))
head(raw_data, n = 10)
```

There are things to note before we clean:  
- city: there are observations that have multiple cities nested in one row.  
- post_date: dates are coupled with time stamps, thus in character format not in date format.  
- state: nearly 30% of state information is missed. Multiple name of states are nested in one row and are not in uniform format.  
- geo: contained both geography for Australia and New Zealand.  
- salary_offered: mostly absent.  

In order for the data to be used, we need to separate the nested column and observations, filter the data to include Australia only and filled out the state information, using the third - party list of cities and states in Australia to match with the cities in our data set.

```{r clean-dat, cache = TRUE }
#choose the needed columns only 
data_cleaned <- raw_data %>%
  select(3:9,11)

# separate the post-date column to get the date out
data_cleaned <- data_cleaned %>%
  separate (post_date, into = c("post_date", "tz"), sep = "T")

# convert the post_date column from character to date format
data_cleaned %>%
  mutate_at(vars(post_date), as.Date, format = "%Y-%m-%d")
```

```{r read-states}
states <- read.csv(here::here("data","au.csv"))
```

```{r state-clean, cache = TRUE, fig.cap="Missing value visualization after columns and rows separation", echo = FALSE}
# Clean and update state names
by_city <- data_cleaned %>%
  filter(geo == "AU") %>%
  separate_rows(city, sep = " & ") %>%
  separate_rows(city, sep = ", ") %>%
  separate_rows(city, sep = " and ")

# Specify names for each city
by_city <- by_city %>%
  left_join(states, by = "city") %>%
  rename("state" = admin)

# check the missing
vis_miss(by_city)
```

```{r clean-city-name, cache = TRUE}
# Manually adjust missing state
by_city_cleaned <- by_city %>%
  mutate(
    state = case_when(
    str_detect(city, "TAS") ~ "Tasmania",
    str_detect(city, "VIC") ~ "Victoria",
    str_detect(city, "NSW") ~ "New South Wales",
    str_detect(city, "ACT") ~ "Australian Capital Territory",
    str_detect(city, "QLD") ~ "Queensland",
    str_detect(city, "SA") ~ "South Australia",
    str_detect(city, "Wide Bay Burnett") ~ "Queensland",
    str_detect(city, "Sunshine Coast") ~ "Queensland",
    str_detect(city, "Great Ocean Road") ~ "Victoria",
    str_detect(city, "Mackay") ~ "Queensland",
    str_detect(city, "Coalfields") ~ "New South Wales",
    str_detect(city, "Murray") ~ "Victoria",
    str_detect(city, "Maitland") ~ "New South Wales",
    str_detect(city, "Hunter") ~ "New South Wales",
    str_detect(city, "Gosford") ~ "New South Wales",
    str_detect(city, "Pilbara") ~ "Western Australia",
    str_detect(city, "Central Highlands") ~ "Queensland",
    str_detect(city, "Blue Mountains") ~ "New South Wales",
    str_detect(city, "Northern Australia") ~ "Northern Territory",
    str_detect(city, "Illawarra") ~ "New South Wales",
    str_detect(city, "South Coast") ~ "New South Wales",
    str_detect(city, "Southern Tablelands") ~ "New South Wales",
    str_detect(city, "Far North") ~ "Queensland",
    str_detect(city, "Hawkesbury") ~ "New South Wales",
    str_detect(city, "Darling Downs") ~ "Queensland",
    str_detect(city, "Kimberley") ~ "Western Australia",
    str_detect(city, "Peel") ~ "Western Australia",
    str_detect(city, "La Trobe Valley") ~ "Victoria",
    str_detect(city, "Somerset") ~ "Queensland",
    str_detect(city, "Lockyer") ~ "Western Australia",
    str_detect(city, "Goldfields") ~ "Western Australia",
    str_detect(city, "Macedon Ranges") ~ "Victoria",
    str_detect(city, "Mt Gambier") ~ "South Australia",
    str_detect(city, "Limestone Coast") ~ "South Australia",
    str_detect(city, "Wheatbelt") ~ "Western Australia",
    str_detect(city, "Riverina") ~ "New South Wales",
    str_detect(city, "Capricorn Coast") ~ "Queensland",
    str_detect(city, "Gascoyne") ~ "Western Australia",
    str_detect(city, "Mornington Peninsula") ~ "Victoria",
    str_detect(city, "Bass Coast") ~ "Victoria",
    str_detect(city, "Lismore") ~ "New South Wales",
    str_detect(city, "Far North Coast") ~ "New South Wales",
    str_detect(city, "Goulburn Valley") ~ "Victoria",
    str_detect(city, "Yarra Valley") ~ "Victoria",
    str_detect(city, "High Country") ~ "Victoria",
    str_detect(city, "Eyre Peninsula") ~ "South Australia",
    str_detect(city, "Bairnsdale") ~ "Victoria",
    str_detect(city, "Gippsland") ~ "Victoria",
    str_detect(city, "Mt Isa") ~ "Queensland",
    str_detect(city, "North Coast") ~ "New South Wales",
    str_detect(city, "Albury Wodonga") ~ "New South Wales",
    str_detect(city, "Yorke Peninsula") ~ "South Australia",
    str_detect(city, "Clare Valley") ~ "South Australia",
    str_detect(city, "Fraser Coast") ~ "Queensland",
    str_detect(city, "Great Southern") ~ "Western Australia",
    str_detect(city, "Tamworth") ~ "New South Wales",
    str_detect(city, "Southern Highlands") ~ "New South Wales",
    str_detect(city, "Tablelands") ~ "Queensland",
    str_detect(city, "Snowy") ~ "New South Wales",
    str_detect(city, "Monaro") ~ "New South Wales",
    str_detect(city, "West Gippsland") ~ "Victoria",
    str_detect(city, "Latrobe Valley") ~ "Victoria",
    str_detect(city, "Adelaide Hills") ~ "South Australia",
    str_detect(city, "Barossa") ~ "South Australia",
    str_detect(city, "Albury Area") ~ "New South Wales",
    str_detect(city, "Grampians") ~ "Victoria",
    str_detect(city, "Riverland") ~ "South Australia",
    str_detect(city, "Murray Mallee") ~ "Victoria",
    str_detect(city, "Fleurieu Peninsula") ~ "South Australia",
    str_detect(city, "Kangaroo Island") ~ "South Australia",
    str_detect(city, "Coober Pedy") ~ "South Australia",
    str_detect(city, "Central West") ~ "New South Wales",
    str_detect(city, "South West") ~ "South Australia",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "North West") ~ "Tasmania",
    str_detect(city, "Central Australia") ~ "Northern Territory",
    str_detect(city, "Midwest") ~ "Western Australia",
    str_detect(city, "Far West") ~ "New South Wales",
    str_detect(city, "South East") ~ "Tasmania",
    str_detect(city, "North East") ~ "Tasmania",
    str_detect(city, "Central") ~ "Tasmania",
    TRUE ~ as.character(state))
  ) %>%
  filter(!city == "")
```

This is the data set after we have done the cleaning, choosing only the variables needed for the analysis:

```{r}
# Select only the columns needed
by_city_cleaned <- by_city_cleaned %>%
  select(- c(lat, lng, country, iso2, capital, population, population_proper))
head(by_city_cleaned)
```

_Reources:_ 
https://simplemaps.com/data/au-cities

####. Missing values  (Hanh - Hanh-Ngo branch)  
```{r missing, fig.cap= "Missing values visualization after the cleaning"}
# Using the raw data to show missing values
miss_data <- by_city_cleaned %>%
  # Replace blank values with NA
  mutate_all(na_if,"")
vis_miss(miss_data)
```

A quick overview showed that out of all variables chosen, job description is the only variable that had missing values and at a really high ratio - 75.3%, other variables are fully present. However, job description is not of importance for this study, hence we can conclude that this data set requires no further cleaning and is ready for use.


### Analyze the change in demand by job category) (Peimin-Peimin branch)

```{r jobctegory}
# Select job category
jobcategory <- data_cleaned  %>% dplyr::select(post_date,
                                               category) %>%
  separate(post_date, c("Year","Month","day"))%>%
# and delete "year" and "day" in variable "post_day"
 select(-"Year", -"day") 

```
```{r category_num, fig.cap= " The number of jobs per category"}

library(kableExtra)
canum <- jobcategory %>%
  arrange(number) #arrange the number of category from small to large
  count(category,sort = TRUE, name = "number")%>%
kable(canum, caption = " The number of jobs per category  ") %>%	
kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r monthly_dirtribution, fig.cap="Monthly job category distribution"}
  count(Month,category,sort = TRUE, name = "number")%>%
distribution <- jobcategory  %>%
  arrange(Month) %>%
   ggplot(aes(x = Month, y = number)) + 
   geom_col(position = "dodge") + 
  # wrap category into detail screen, each coloumn have five categories
   facet_wrap(~category, ncol = 5) +
  # job category title front size as 6.5
   theme_bw(base_size = 6.5)+
  # x aes front size angle set as 50
   theme(axis.text.x = element_text(angle = 50, vjust = 1)) + 
   ggtitle("Monthly job category distribution") 

distribution
```
```{r Month_number, fig.cap="Top 5 category in each month"}

monthly <- jobcategory  %>% 
  count(category,Month,sort = TRUE, name = "number") %>%
  arrange(Month) %>%
  group_by(Month) %>%
   ggplot() +
  top_n(5) %>% # select each months' top five job categories 
  geom_point(mapping = aes(x = Month, y = number, color = category)) + # fill category in difference color
  ggtitle("Top 5 category in each month")+
   theme_bw(base_size = 11.5)+
   theme(axis.text.x = element_text(angle = 50, vjust = 1)) 
   
monthly
```


There are 30 jobs category in this dataset and figure\ref{fig: category_num}  list the number of jobs per category from April to November in 2018. The category of trades and services was the most popular jobs category in 2018 in Australia and information and communication technology was the second which the job posting number almost the same as the first place. From Labour Market Information Portal known that those two categories have been in short supply in Australian labour market. Because of the small population and culture influence, Burgess (2018) said automation cannot completely replace manual, so far trade and services fully occupied the top spots. For a better timely observation through every month, figure\ref{fig: monthly_dirtribution}  shows each jobs category requirement change in difference month which not only show the shortage job, but also show some category is becoming saturated. It is more clearly show whether there is some job category in high demand every month in a year, whether there is a job have seasonal requirement, for example, accounting would have a high demand in June every year before the end of financial year, some categories have high demand in Christmas. Meanwhile, figure\ref{fig: Month_numbercreates} a graph list top five jobs category in each month. There are 7 categories became the most frequently appeared in the list, for example accounting, administration and office support, healthcare and medical, hospitality and tourism, information and communication technology, Manufacturing, Transport and Logistics, Trade and Services. In October, there were more vacancy and labour requirement than other month. Forbes (2019) shown a statistics report that most industries would figure out what they need in September because holiday was coming and finish job before year-end. Thus, October became the busiest month for recruiting that the number of job posting in additional increase. When it comes to November, the number of jobs posting number in whole labour market got a sharp drop that a new round of hiring has end in October and all goes quiet before Christmas and New Year. 

### Analyze the change in demand by states + life quality  
####. Change in demand (Hanh)    
```{r state-demand, fig.cap= "Daily job count by states", fig.align = "center"}
# Convert Date column from character to Date format for geom_line
by_city_cleaned <- by_city_cleaned %>%
  mutate_at(vars(post_date), as.Date, format = "%Y-%m-%d")

by_city_cleaned %>%
  group_by(post_date, state) %>%
  summarise("count" = n()) %>%
  ungroup() %>%
  ggplot(aes(x = post_date,
             y = count)) +
  geom_line(color = "#00008B") +
  facet_wrap(~ state, scales = "fixed") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.3)) +
  theme_bw() +
  labs(title = "Count of jobs posted by days",
       x = "Date",
       y = "Number of jobs")
```

Looking at figure \@ref(fig:state-demand), we could see that NSW, Victoria and Queensland lead the national job pool with highest counts observed among all the states. The patterns of job post appeared to look similar across the states with the highest peak in April, followed by two other minor peaks on July. 

To have a better look at the states with lower job counts, which are Australia Capital Territory, Northern Territory, South Australia and Tasmania, we isolated them from the high - count states and look at the change separately.

```{r low-demand-state, fig.cap= "Daily job counts in ACT, NT, SA and TAS"}
by_city_cleaned %>%
  filter(!state %in% c("New South Wales",
                    "Queensland",
                    "Victoria",
                    "Western Australia")) %>%
  group_by(post_date, state) %>%
  summarise("count" = n()) %>%
  ungroup() %>%
  ggplot(aes(x = post_date,
             y = count)) +
  geom_line(color = "#FF0000") +
  facet_wrap(~ state, scales = "fixed") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.3)) +
  theme_bw() +
  labs(title = "Count of jobs posted by days",
       x = "Date",
       y = "Number of jobs")
```

Figure \@ref(fig:low-demand-state) showed that the other four states had roughly the same pattern of job post changed. 

Normally, the job hunting season usually peaks around the beginning of the year, mostly in January as most companies having robust budgets for hiring and just got out of a holiday season in December. The same situation applies for job seekers as well as people start to come back from the holiday, usually busted with new year resolution; also the annual bonus has been paid at the end of last year, making people more ready to change job starting from January. This data set did not include data from January to March so we cannot verify the situation. However it would be safe to assume that this new year effect lasts further into April. Another peak is around July, which marks the start of new financial year for most companies, giving them higher budget for new hiring.

Despite the similarity in seasonal pattern, the difference in job count was prominent across the states. Big states like NSW, Victoria and Queensland held the majority of opportunities, with the highest count could even got more than 7 times higher than the highest count in the low - demand states (NSW versus South Australia). Even though it was common sense that big states would have more opportunity, the amount gap looked even more significant when presented visually.

####. How does it reflect life quality? (Dewi)

### Analyze the change in demand by job type (Justinâ€™s branch)

# Conclusion: (Justin - master branch)





### Job availibility and living cost
According to @davidlasswell, when searching for a job, cost of living should be taken into account. It also relates to the question whether the salary of the job would be enough to cover the living cost in a particular city. Therefore, in this subsection, the living cost in some cities in Australia with relatively had more job listings would be observed.
```{r livingcost, message = FALSE, include = FALSE}
# Scraping living cost data
library(polite)
library(rvest)
library(xml2)
library(readr)
# ensure that the website is scrapable 
bow("https://www.numbeo.com/cost-of-living/rankings.jsp?title=2018")
cost <- bow("https://www.numbeo.com/cost-of-living/rankings.jsp?title=2018")
cost_scraped <- scrape(cost)
# scrape the city column
city <- cost_scraped %>%
  html_nodes(".cityOrCountryInIndicesTable") %>%
  html_text()
# make a function to scrape based on html nodes
get_data <- function(column){
  cost_scraped %>% 
    html_nodes(paste0("td:nth-child(",column,")")) %>% 
    html_text() %>% 
    parse_number

# scrape the living cost index
rent <- get_data("4")
cost_living_rent <- get_data("5")
grocery <- get_data("6")
restaurant <- get_data("7")
local_purchase_power <- get_data("8")
# create the table of living cost
cost_of_living <- tibble(city = city,
                         rent = rent,
                         grocery = grocery,
                         restaurant = restaurant,
                         local_purchasing_power_index = local_purchase_power,
                         living_cost_incld_rent = cost_living_rent)
# filter only the country in Australia
cost_of_living_au <- cost_of_living %>%
  filter(str_detect(city,"Australia")) %>%
  separate(city, into = c("city", "country"), sep = ",")
# add state column to the data
cost_of_living_state <- cost_of_living_au %>% mutate(
  state = case_when(
    str_detect(city, "Sydney") ~ "NSW",
    str_detect(city, "Newcastle") ~ "NSW",
    str_detect(city, "Brisbane") ~ "QLD",
    str_detect(city, "Gold Coast") ~ "QLD",
    str_detect(city, "Canberra") ~ "ACT",
    str_detect(city, "Perth") ~ "WA",
    str_detect(city, "Melbourne") ~ "VIC",
    str_detect(city, "Adelaide") ~ "SA",
    str_detect(city, "Hobart") ~ "TAS",
    str_detect(city, "Darwin") ~ "NT",
    str_detect(city, "Cairns") ~ "QLD")
)
```
```{r livingcostplot, fig.cap = "Living cost of 2018 by city"}
library(forcats)


ggplot(cost_of_living_state) +
  geom_point(aes(x = living_cost_incld_rent,
                 y = reorder(city, living_cost_incld_rent)),
             color = "#FF0080") +
  xlab("Cost of living plus rent index") +
  ylab("City")+
  theme_bw()

```




Figure \ref{fig:livingcostplot} shows that Sydney was found to be the city with the highest living cost, about 80. Whilst generally, the living cost index in most cities in Australia ranged betwen 60 to 68. The figure also conveys that Gold Coast was the city with the lowest living cost in Australia. 

It is also interesting to observe whether there is a correlation between the living cost in those cities and the number of job listings in there. Hence, the number of job listings in those cities would be examined first.

```{r jobcity}

job_city_table <- data_cleaned %>%
  group_by(city) %>%
  count() %>%
  arrange(desc(n)) %>%
  filter(city %in% c("Sydney", 
                     "Melbourne", 
                     "Brisbane", 
                     "Perth", 
                     "Adelaide", 
                     "Hobart", 
                     "Darwin", 
                     "ACT", 
                     "Gold Coast", 
                     "Newcastle, Maitland & Hunter", 
                     "Cairns & Far North")) %>%
  ungroup() %>%
  # change the city name
  mutate(city = case_when(
    str_detect(city, "Sydney") ~ "Sydney",
    str_detect(city, "Newcastle") ~ "Newcastle",
    str_detect(city, "Brisbane") ~ "Brisbane",
    str_detect(city, "Gold Coast") ~ "Gold Coast",
    str_detect(city, "ACT") ~ "Canberra",
    str_detect(city, "Perth") ~ "Perth",
    str_detect(city, "Melbourne") ~ "Melbourne",
    str_detect(city, "Adelaide") ~ "Adelaide",
    str_detect(city, "Hobart") ~ "Hobart",
    str_detect(city, "Darwin") ~ "Darwin",
    str_detect(city, "Cairns") ~ "Cairns"))
library(kableExtra)
kable(job_city_table,
      caption = "The number of job listings in some cities in Australia in 2018",
      "latex",
      col.names = c("City", "Number of Job Listings"),
      booktabs = TRUE) %>%
  kable_styling(latex_options = "striped")
```



Table \ref{tab:jobcity} conveys that Sydney, was being the cities with most job listings. These cities had more than 1000 jobs available in April to December 2018. Meanwhile, Hobart was found to be the city with the least job listings among others. The large number of job listings in Sydney was possibly due to the fact that Sydney was placed to be the city with highest productivity in Australia [@pwcreport].

```{r corrplot, fig.cap= "Cost of living plus rent index vs Number of job listings Scatter Plot"}

#join the table for correlation calculation
job_cost_corr <- cost_of_living_state %>%
  left_join(job_city_table, by = "city")

#make the scatter plot
ggplot(job_cost_corr) +
  geom_point(aes(x =living_cost_incld_rent,
             y = n),
             color = "#138D75") +
  xlab("Cost of living plus rent index") +
  ylab("Number of job listings") +
  theme_bw()

#calculate correlation
corr <- cor(job_cost_corr$living_cost_incld_rent, 
            job_cost_corr$n)

corr_test <- cor.test(job_cost_corr$living_cost_incld_rent, 
            job_cost_corr$n)
  
```



Figure \ref{fig:corrplot} suggests that there is a possible correlation between cost of living and the number of job listings in Australia. However, the pattern can not be really seen since the number of observations is too small. Therefore, the extension of analysis was performed by using Pearson correlation coefficient. The finding is that the there was a significantly positive (`r corr`) correlation between these two variables. This is inline with what @DePietro stated that the increasing living cost is often associated with employment growth and income growth. Further, larger cities tend to be perceived as the expensive places to live [@Weinstein].


